<html>
<head>
    <meta charset="UTF-8"/>
    <title>王者荣耀论坛</title>
    <link rel="stylesheet" href="../css/common.css"/>
    <link rel="stylesheet" href="../css/common-new.css"/>
    <link rel="stylesheet" href="../css/index.css"/>
    <link rel="stylesheet" href="../css/search.css"/>
    <link rel="stylesheet" href="../css/index-new.css"/>
    <script type="text/javascript" src="../js/jquery-1.12.4.js"></script>
    <script type="text/javascript" src="../js/hm-bbs.js"></script>
    <script src="/js/getParameter.js"></script>
    <script>

        <!-- 统计帖子数-->
        $(function () {
            $.post("/article/countArticle.do","",function (data) {
                $("#countToday").text(data[1]);
                $("#countAll").text(data[0]);
            });
        })

    </script>

    <script>

        $(function () {
            //获取区域id
            var zoneId = getParameter("zoneId");
            if(zoneId == null){
                zoneId = 1;
            }
            //这里是给隐藏域添加区域id 为的是发布帖子时有区域id
            $("#zoneId").prop("value",zoneId);

            //这里是区域导航
            $.post("/zone/findAll.do",{},function (data) {

                var str = "";
                $.each(data,function (index, ele) {

                    if(ele.zoneId == zoneId){
                        str += "<li class=\"current\">\n" +
                    "                <a href=\"/html/index.html?zoneId="+ele.zoneId+"\" ><em></em>"+ele.zoneName+"</a>\n" +
                    "            </li>"
                    }else {
                        str += "<li>\n" +
                    "                <a href=\"/html/index.html?zoneId="+ele.zoneId+"\" ><em></em>"+ele.zoneName+"</a>\n" +
                    "            </li>"
                    }
                })

                $("#navigation_ul").html(str);

            })

            //这里是区域信息
            $.post("/article/findByZoneId.do",{zoneId:zoneId},function (data) {
                var str = "";
                //这个遍历是先遍历置顶的
                $.each(data,function (index, ele) {
                    if (ele.isTop == 1 && ele.isReport !=1) {
                        str += "<li class=\"clearfix ding\">\n" +
        "                        <div class=\"hm-index-title\">\n" +
        "                            <i class=\"set-to-top\">顶</i> <a href=\"html/getArticle.html?articleId="+ele.articleId+"\">" + ele.title + "</a>\n" +
        "                        </div>\n" +
        "                        <div class=\"hm-index-con\">" + ele.content + "</div>\n" +
        "                        <div class=\"hm-index-info l\">\n" +
        "                            <span class=\"article-username\">" + ele.senderName + "</span>\n" +
        "                            <span class=\"post-time\">" + ele.sendTimeStr + "</span>\n" +
        "                        </div>\n" +
        "                        <div class=\"hm-index-fun r\">\n" +
        "                            <span class=\"icon-like\"><i></i>" + ele.upvoteCount + "</span>\n" +
        "                            <span class=\"icon-talk\"><i></i>" + ele.replyCount + "</span>\n" +
        "                        </div>\n" +
        "                    </li>"
                    }
                })
                //这个遍历是没有置顶的
                $.each(data,function (index, ele) {
                    if (ele.isTop == 0 && ele.isReport !=1) {
                        str += "<li class=\"clearfix\">\n" +
                            "    <div class=\"hm-index-title\">\n" +
                            "        <i class=\"set-to-top\">顶</i> <a href=\"html/getArticle.html?articleId="+ele.articleId+"\">" + ele.title + "</a>\n" +
                            "    </div>\n" +
                            "    <div class=\"hm-index-con\">" + ele.content + "</div>\n" +
                            "    <div class=\"hm-index-info l\">\n" +
                            "        <span class=\"article-username\">" + ele.senderName + "</span><span class=\"post-time\">" + ele.sendTimeStr + "</span>\n" +
                            "    </div>\n" +
                            "    <div class=\"hm-index-fun r\">\n" +
                            "        <span class=\"icon-like\"><i></i>" + ele.upvoteCount + "</span>\n" +
                            "        <span class=\"icon-talk\"><i></i>" + ele.replyCount + "</span>\n" +
                            "    </div>\n" +
                            "</li>\n"
                    }
                })
                $("#article_ul").html(str)
            })

            //这里是表单提交后获取提交的帖子的id 然后要跳转到getArticle.html页面
            // 去那里查询该帖信息回显到页面
            $("#button").click(function () {
                $.post("/article/save.do",$("#form").serialize(),function (data) {

                    var id = data;
                    location.href = "html/getArticle.html?articleId="+id;
                });
            });

        })



    </script>

</head>
<body>
<!-- 头部 -->
<div class="hm-top-nav">
    <div class="hm-inner clearfix">
        <div class="hm-inner-l l"></div>
        <div class="hm-inner-r r">
            <div class="box">
                <a href="javascript:;" id="login" class="to-login">游客登录</a>
                <a href="register.html">【新用户注册】</a>
                <div id="dialogBg"></div>
                <div id="dialog" class="animated">
                    <img class="dialogIco" width="50" height="40" src="../images/ico.png"/>
                    <div class="dialogTop" style="height:25px;">
                        <a href="javascript:;" class="closeDialogBtn">关闭</a>
                    </div>
                    <form action="user/login.do" >
                        <ul class="editInfos">
                            <li>用户名：<input type="text" id="userName" name="userName" class="ipt"/></li>
                            <li>密&nbsp;&nbsp;&nbsp;码：<input type="password" id="userPass" name="userPass" class="ipt"/></li>
                            <li><input type="submit" value="登录" class="submitBtn"/></li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 主体部分 -->
<div class="hm-header"></div>
<div class="hm-body hm-body-bgc">
    <div class="hm-inner">
        <div class="hm-banner"></div>




        <!--头部，帖子统计，搜索-->
        <div class="hm-bbs-info">
            <div class="hm-bbs-icon l" style="width:130px;">
                <span><img src="../images/bbs-icon.png" height="80"/></span>
            </div>
            <div class="hm-bbs-info-in l" style="margin-left:30px;">
                <div class="t clearfix"><h2 class="l">王者荣耀</h2></div>
                <p>
                    <span>今日帖子<strong id="countToday"></strong></span>
                    <span>全部帖子<strong id="countAll"></strong></span>
                </p>
            </div>
            <div class="search-box l">
                <form action="javascript:;" method="post" id="form_serch">
                    <input type="text" name="sou" class="txt l" placeholder="请输入关键字" id="text1">
                    <input type="submit" value="搜索" class="btn l"/>
                </form>
            </div>
        </div>

        <script>
            $(function () {
                $("#form_serch").submit(function () {
                    $.post("/article/findByTitle",$("#form_serch").serialize(),function (data) {
                        //获取ul
                        var ul = $("#article_ul");
                        ul.html(null);
                        $(data).each(function () {
                            if (this.isTop==1) {//创建li
                                var li =
                                    "<li class=\"clearfix ding\">\n" +
                                    "<div class=\"hm-index-title\">\n" +
                                    "<i class=\"set-to-top\">顶</i> <a href=\"getArticle.html\">"+this.title+"</a>\n" + "</div>\n" +
                                    " <div class=\"hm-index-info l\">\n" +
                                    "    <span class=\"article-username\">"+this.senderName+"</span>\n" +
                                    "      <span class=\"post-time\">"+this.sendTimeStr+"</span>\n" +
                                    "  </div>\n" +
                                    "  <div class=\"hm-index-fun r\">\n" +
                                    "      <span class=\"icon-like\"><i></i>"+ this.upvoteCount +"</span>\n" +
                                    "  <span class=\"icon-talk\"><i></i>"+ this.replyCount+"</span>\n" +
                                    "  </div>\n" +
                                    "  </li>"
                                //调用ul添加li
                                ul.append(li);

                            }else if (this.isTop==0) {
                                //创建li
                                var li =
                                    "<li class=\"clearfix\">\n" +
                                    "<div class=\"hm-index-title\">\n" +
                                    "<i class=\"set-to-top\">顶</i> <a href=\"getArticle.html\">"+this.title+"</a>\n" + "</div>\n" +
                                    " <div class=\"hm-index-info l\">\n" +
                                    "    <span class=\"article-username\">"+this.senderName+"</span>\n" +
                                    "      <span class=\"post-time\">"+this.sendTimeStr+"</span>\n" +
                                    "  </div>\n" +
                                    "  <div class=\"hm-index-fun r\">\n" +
                                    "      <span class=\"icon-like\"><i></i>"+ this.upvoteCount +"</span>\n" +
                                    "  <span class=\"icon-talk\"><i></i>"+ this.replyCount+"</span>\n" +
                                    "  </div>\n" +
                                    "  </li>"
                                //调用ul添加li
                                ul.append(li);
                            }

                        });
                    },"json");
                });
            })
        </script>



        <!-- 导航 -->
        <ul class="hm-bbs-nav border-lrb clearfix" id="navigation_ul">
            <!--导航板块-->
        </ul>




        <!-- 主体部分 -->
        <div class="hm-bbs-main border-lrb clearfix">
            <!-- 左侧列表 -->
            <div class="list-view l">
                <ul id="article_ul">

                </ul>
            </div>





            <!-- 右侧侧边栏,在线用户 -->
            <div class="aside l">
                <div class="aside-box">
                    <h3 class="t">
                        <a href="javascript:;" id="loginUser"></a>
                    </h3>
                    <ul class="b clearfix" id="loginUserUl">

                        <script>
                            $(function () {
                                $("#loginUser").click(function () {
                                    $.get("/user/findAll",{},function (data) {
                                        var ul = $("#loginUserUl");
                                        ul.html(null);
                                        var count= 0;
                                        $(data).each(function () {
                                            if (this.loginStatus ==1){
                                                count  += 1;
                                                var li =
                                                        "<li>/n"+
                                                        "<div><img src='"+this.picUrl+" '+ height='55'/> </div>\n"+
                                                        "<p>"+this.userName+"</p>\n"+
                                                        "</li>";

                                                ul.append(li);
                                            }

                                        });
                                        $("#loginUser").html("在线用户"+count);
                                    });

                                });
                            });
                        </script>
                        <li>
                            <div><img src="../images/default.png" height="55"/> </div>
                            <p>Mr.King</p>
                        </li>
                        <li>
                            <div><img src="../images/default.png" height="55"/></div>
                            <p>疯子</p>
                        </li>


                    </ul>
                </div>
            </div>



        </div>
    </div>
</div>


<!-- 底部 -->
<div class="hm-footer" style="padding-top:10px;">
    <div class="hm-inner">
        <div class="hm-footer-cpr">
            <p>Copyright@2006-2017 ITCAST. All Rights Reserved</p>
            <p>传智播客 版权所有</p>
        </div>
    </div>
</div>

<!-- 右边发帖，回顶部 -->
<div class="fixedBar" id="j_fixedBar">
    <a id="newTopicBtn" href="javascript:;" class="newTopic"><span></span>发帖</a>
    <a href="#" class="goTop"><i></i><span>返回<br/>顶部</span></a>
</div>

<!-- 发帖弹出框 -->
<form id="form" method="post">
    <div class="pop-box ft-box">
        <div class="mask"></div>
        <div class="win">
            <div class="win_hd">
                <h4 class="l">主题帖</h4><span class="close r">&times;</span>
            </div>
            <div class="win_bd">
                <div class="win_bd_t">
                    <input type="text" id="title" name="title" placeholder="帖子标题"/>
                </div>
                <div class="win_bd_b">
                    <textarea id="content" name="content" placeholder="正文"></textarea>
                </div>
                    <!--这里是一个隐藏域 为的是提交的帖子有区域id -->
                    <input id="zoneId" type="hidden" name="zoneId"/>
            </div>
            <div class="win_ft">
                <div class="win_ft_in">
                    <input id="button" type="button" class="btn" value="发表"/>
                </div>
            </div>
        </div>
    </div>
</form>


</body>
</html>
<script type="text/javascript">
  $(function () {
      //显示弹框
      $('.box #login').click(function () {
          var className = $(this).attr('class');
          $('#dialogBg').fadeIn(300);
          $('#dialog').removeAttr('class').addClass('animated ' + className + '').fadeIn();
          $('#userName').focus();
          $("#j_fixedBar").hide();
      });

      //关闭弹窗
      $('.closeDialogBtn').click(function () {
          $('#dialogBg').fadeOut(300, function () {
              $('#dialog').addClass('bounceOutUp').fadeOut();
              $("#j_fixedBar").show();
          });
      });

      //查询用户是否登录
      $.post("user/findUser.do",{},function(data){

          alert(data);
      })
  });


</script>